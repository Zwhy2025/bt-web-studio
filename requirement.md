# 行为树 Web 可视化与调试平台需求调研与分析

## 1. 背景与目的

行为树（Behavior Tree，BT）是一种用于描述决策逻辑的树形结构，广泛应用于游戏 AI、机器人控制和自动驾驶等领域。开源库 BehaviorTree.CPP 提供了可扩展的行为树执行框架，但开发者在设计、调试和监控行为树时需要配套的可视化工具。

Groot 系列是 BehaviorTree.CPP 官方的图形化工具。Groot1 是基于 Qt 的开源工具，主要提供行为树的创建和可视化功能；Groot2 是其商业版重写版本，引入了监控、调试和日志回放等高级特性，但源码闭源。为满足项目在 Web 环境下对行为树的可视化、调试和回放需求，需要对现有工具功能进行调研并制定 Web 版工具的需求。

## 2. 现有工具功能综述

### 2.1 Groot2

Groot2 官方网站及文档描述了其主要功能，分为“编辑器”“实时监视器”和“日志可视化”三个部分。

#### 行为树编辑器（BT Editor）：

- 拖拽式创建和编辑树，支持通过节点面板连接节点。
- 支持多个文件，便于管理大型项目。
- 兼容 BT.CPP 3 与 4 版本。
- 支持双树分屏对比和实时预览 XML。
- PRO 版增加“大树搜索节点”功能。

#### 实时监视器（Real‑time Monitor）：

- 连接正在运行的 BT.CPP 执行器，实时可视化树节点状态。
- 记录所有状态转移为日志文件，供后续分析。
- PRO 版支持黑板变量的可视化、交互式断点和故障注入，以及运行时将某节点替换为虚拟节点。

#### 日志可视化（Log Visualization）：

- 打开日志文件并以不同速度回放，显示节点在 RUNNING 状态的持续时间及状态变化次数，并支持根据节点名或时间范围过滤事件。

#### 商业模式与限制：

- 基础版免费提供完整的编辑器，以及节点数量限制为 20 的监视器和日志可视化；PRO 版（年费 690 €）解锁无限节点、搜索、交互调试等。官网还提供一个月的试用版和源代码托管承诺。
- Changelog 中的新特性（示例）：
  - 日志回放新增“过滤条件”和结果导出 JSON 的能力。
  - 编辑器改进了前置/后置条件（Pre/Post Conditions）的显示，并允许保存为 Groot1 的 XML 语法。
  - 新增内置节点如 和 。
  - 断点支持保存/加载，日志解析支持插件机制，回放可以缩放时间范围。

#### 与 BT.CPP 的集成：

- 文档指出，通过在 C++ 中创建 `` 可与 Groot2 进行通信，这个服务会将树结构和模型发送给 Groot2，定期更新节点状态，传递黑板变量，并允许 Groot2 插入断点、替换节点或进行故障注入。

### 2.2 Groot1（开源）

开源版 Groot1 的 README 强调该项目已停止更新，兼容 BT.CPP 3.8.x，不支持 4.x。主要功能包括：

- 基于 Qt 的图形编辑器，用于创建和可视化行为树；
- 依赖 BT.CPP 并提供视频示例；
- 提供编译和安装说明。

在 ROS Nav2 的教程中，Groot1 提供了下列功能：

- 通过加载“节点模型（Palette）”来显示自定义节点；用户需导入包含节点定义的 XML 文件，否则只能显示 BT.CPP 默认节点。
- 编辑行为树：在编辑器中从节点面板拖入新节点并连接，修改节点属性后保存。
- 创建自定义节点：在 GUI 中填写节点名称、类型和端口信息，即可生成新的节点模型并导出，便于在树中使用。

Groot1 没有实时监控和日志回放功能，扩展性较差，因此社区逐步转向 Groot2。

## 3. 用户角色与使用场景分析

### 角色主要需求与场景

#### 算法/AI 工程师

- 需要通过图形界面快速搭建和修改行为树逻辑，并与代码配合调试；希望支持回放和性能分析，以优化算法决策。

#### 机器人系统集成开发者

- 希望在部署行为树应用时，能够实时监控运行状态，快速定位故障；支持修改节点参数并观察效果；可在浏览器中操作，避免额外软件安装。

#### 测试工程师 / 业务运营人员

- 希望在无需编写代码的情况下观察机器人行为，执行过程回放，验证新版本性能；需要友好的日志管理与导出接口，用于报告生成。

#### 项目经理/产品经理

- 关心工具的易用性、学习成本、稳定性以及对团队开发流程的改进；需要理解功能差异，以制定开发计划和成本评估。

## 4. 功能需求分析

结合现有工具的特性与用户需求，拟定 Web 版行为树可视化与调试平台（下称“BT Web”）的主要功能模块。

### 4.1 行为树编辑器

- **拖拽式节点编排**：提供可视化操作面板，可从节点库拖拽节点到画布并连接，支持修改节点名称、端口参数等。功能类似 Groot2 的“拖放编辑”和实时 XML 预览。
- **项目管理**：支持多文件或多树管理，可将复杂逻辑拆分成子树并引用；支持导入/导出 BT.CPP 兼容的 XML 格式，并兼容 Groot1 语法模式。
- **节点库管理**：
  - 支持导入节点模型文件（XML），自动将自定义节点加入面板；
  - 提供“创建自定义节点”界面，可输入节点名称、类型（Action/Condition/Decorator 等）及端口信息并保存；
  - 支持搜索节点（针对大型树），参照 Groot2 PRO 版的“搜索节点”功能。
- **版本控制与比较**：支持历史版本存档和差异比较；支持分屏查看两个行为树并进行比对。

### 4.2 实时监控与调试

- **运行状态可视化**：通过 WebSocket 等实时通信，显示行为树执行过程中每个节点的状态（RUNNING、SUCCESS、FAILURE、IDLE），并可更新黑板变量。
- **调试断点与单步执行**：允许设置断点，支持在断点处暂停、继续、跳过或修改节点返回值，类似 Groot2 PRO 版的交互式调试。
- **节点替换与故障注入**：允许用户在调试时将某个节点替换为“模拟节点”，或注入故障以观察系统反应，这一点在 Groot2 中作为专业版特性。
- **黑板监视与变量修改**：显示实时黑板变量，支持基本类型；提供编辑功能以便在调试时修改变量值并观察影响。

### 4.3 日志记录与回放

- **日志记录**：运行时自动记录节点状态变化和时间戳，保存为可回放的日志格式，与 Groot2 的“记录所有转移到日志文件”一致。
- **回放控制**：提供类似播放器的回放界面，可控制播放速度、暂停、快进/慢放，并在行为树图上同步显示状态变化。
- **时间轴缩放和过滤**：支持缩放时间轴聚焦某一段执行过程，并通过节点名称或时间范围过滤事件，类似 Groot2 日志可视化中提到可对转移表增加过滤条件并导出查询结果。
- **统计与分析**：计算每个节点处于 RUNNING 状态的总时长、执行次数等指标，并以图表或表格形式展示。
- **数据导出**：支持导出日志或过滤结果为 JSON/CSV，以便进一步分析或用于报告。

### 4.4 扩展与生态集成

- **与 BT.CPP/ROS2 集成**：提供标准协议或 SDK，使得机器人端的 BT 执行器可以通过简单的 API 将树结构和状态上报给 Web 平台，类似于。提供不同语言（C++/Python）客户端实现，方便在非 C++ 项目中使用。
- **自定义节点插件机制**：支持自定义节点的插件加载以及日志解析插件，参考 Groot2 日志解析插件机制。
- **协同编辑与权限管理**：支持多人协同编辑行为树，提供角色/权限控制（如只读、编辑、调试）；支持在浏览器共享实时状态。
- **Web 兼容性与平台独立性**：通过纯前端技术实现跨平台访问，避免安装客户端；支持移动端查看。
- **国际化与本地化**：支持中文/英文界面切换；日志与黑板内容支持多语言字符。

## 5. 非功能需求

- **性能**：支持大规模行为树的渲染和交互，响应时间 < 200 ms；支持并发用户访问。
- **可靠性**：保证调试过程中网络断开后的重新连接和数据同步；支持断点和日志恢复；提供异常处理机制。
- **扩展性**：模块化设计，前端、后端和通信层可独立升级；支持插件扩展节点类型、调试工具或数据分析功能。
- **安全性**：通信采用加密（如 WSS），提供认证与授权机制，避免未授权访问机器人执行器；对上传的 XML/日志文件进行校验，防止恶意代码注入。
- **兼容性**：兼容 BT.CPP 3.x 与 4.x，并预留接口以支持未来版本或其他行为树库；支持导入 Groot1 的 XML 树文件
- **易用性**：界面友好，支持拖拽和快捷键操作；提供可视化教程和帮助文档；面向非专业用户的简化模式。

## 6. 技术实现建议

- **前端架构**：使用现代前端框架（如 React/Vue）结合 SVG/Canvas 渲染树状结构；采用状态管理库（如 Redux/Pinia）协调节点状态与 UI；利用 WebAssembly 或 Canvas 优化大型树渲染。
- **后端服务**：提供 REST API 用于文件管理、版本控制、权限管理等；使用 WebSocket 或 gRPC 实时传输节点状态及调试指令。
- **数据存储**：树结构和节点模型可采用文档数据库（如 MongoDB）存储，日志文件可采用对象存储；提供索引以支持查询和过滤。
- **协议设计**：定义统一的消息格式（如 JSON 或 Protocol Buffers），以支持跨语言客户端；支持订阅/发布模式推送节点状态。
- **测试与部署**：采用自动化测试覆盖前端交互和后端 API；支持容器化部署（Docker），可扩展以应对高并发。

## 7. 项目实施规划（建议）

| 阶段 | 核心目标 | 主要输出 |
| ---- | ---- | ---- |
| 需求分析阶段 | 深入调研用户需求，确定 MVP（最小可行产品）的功能范围；编写需求规格说明书 | 《需求规格说明书》 |
| 原型设计阶段 | 完成交互原型、界面设计和技术选型；确认节点模型与协议方案 | 交互原型、技术选型报告 |
| 核心功能开发 | 开发拖拽式编辑器、节点库管理、基本的运行监控和日志记录功能 | 可工作的编辑器与运行监控原型 |
| 高级功能开发 | 实现断点调试、节点替换、故障注入、日志过滤回放等高级功能 | 完整的调试与回放模块 |
| 测试与优化 | 进行功能测试、性能优化和安全检查；编写用户文档 | 测试报告、用户手册 |
| 部署与推广 | 部署到云平台或内部服务器；开展用户培训、收集反馈 | 上线版本、培训材料、反馈收集报告 |

## 8. 总结

Groot2 提供了丰富的行为树编辑、实时监控、日志回放和交互调试功能，这些功能能显著提升开发效率和系统可靠性。然而，其闭源和桌面依赖限制了使用范围。通过将上述核心功能迁移至 Web 平台，并结合 Web 技术的协同、跨平台优势，BT Web 可以为开发者、系统集成人员和测试人员提供灵活的行为树开发、调试和分析环境。需求分析表明，拖拽编辑、实时监控、断点调试、日志回放、节点管理和安全高可用性是系统成败的关键。下一步应在技术和产品层面细化实现方案，确保满足多角色用户的需求。

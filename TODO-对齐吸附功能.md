# å¯¹é½å¸é™„åŠŸèƒ½ - è¯¦ç»†è®¾è®¡ä¸å®ç°è®¡åˆ’

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å¯¹é½å¸é™„åŠŸèƒ½æ—¨åœ¨æå‡è¡Œä¸ºæ ‘ç¼–è¾‘å™¨çš„ç”¨æˆ·ä½“éªŒï¼Œè®©èŠ‚ç‚¹å¸ƒå±€æ›´åŠ æ•´æ´ã€ä¸“ä¸šï¼Œæé«˜è¡Œä¸ºæ ‘çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚

## ğŸ¯ åŠŸèƒ½ç›®æ ‡

### æ ¸å¿ƒä»·å€¼
- **æå‡å¯è¯»æ€§**ï¼šæ•´é½æ’åˆ—çš„èŠ‚ç‚¹è®©è¡Œä¸ºæ ‘ç»“æ„æ›´æ¸…æ™°
- **ä¸“ä¸šå¤–è§‚**ï¼šå¯¹é½çš„å¸ƒå±€çœ‹èµ·æ¥æ›´ä¸“ä¸šã€æ›´æ•´æ´  
- **æå‡æ•ˆç‡**ï¼šå‡å°‘æ‰‹åŠ¨è°ƒæ•´èŠ‚ç‚¹ä½ç½®çš„æ—¶é—´
- **ä¸€è‡´æ€§**ï¼šç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹éƒ½éµå¾ªç›¸åŒçš„å¯¹é½è§„åˆ™

### ç”¨æˆ·åœºæ™¯
1. **æ‹–æ‹½åˆ›å»ºèŠ‚ç‚¹**ï¼šæ–°èŠ‚ç‚¹è‡ªåŠ¨å¯¹é½åˆ°åˆé€‚ä½ç½®
2. **è°ƒæ•´èŠ‚ç‚¹å¸ƒå±€**ï¼šæ‹–æ‹½æ—¶è·å¾—å¯¹é½æŒ‡å¯¼
3. **æ‰¹é‡æ•´ç†**ï¼šé€‰æ‹©å¤šä¸ªèŠ‚ç‚¹ä¸€é”®å¯¹é½
4. **ç²¾ç¡®å®šä½**ï¼šç½‘æ ¼å¸é™„é¿å…åƒç´ çº§å¾®è°ƒ

## âœ… ä¸€æœŸå·²å®ç°åŠŸèƒ½

### 1. ç½‘æ ¼å¸é™„ (å·²å®Œæˆ)
- **åŠŸèƒ½**ï¼šæ‹–æ‹½èŠ‚ç‚¹æ—¶è‡ªåŠ¨å¯¹é½åˆ°20pxç½‘æ ¼ç‚¹
- **å®ç°**ï¼šåœ¨ `onNodeDrag` ä¸­è®¡ç®—ç½‘æ ¼ä½ç½®å¹¶åº”ç”¨
- **çŠ¶æ€**ï¼šâœ… æ­£å¸¸å·¥ä½œï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½

### 2. æ‰¹é‡å¯¹é½å·¥å…· (å·²å®Œæˆ)
- **åŠŸèƒ½**ï¼šé€‰æ‹©å¤šä¸ªèŠ‚ç‚¹ï¼Œå³é”®èœå•æä¾›å¯¹é½é€‰é¡¹
- **æ”¯æŒçš„å¯¹é½æ–¹å¼**ï¼š
  - å·¦å¯¹é½ã€å³å¯¹é½ã€æ°´å¹³å±…ä¸­
  - é¡¶éƒ¨å¯¹é½ã€åº•éƒ¨å¯¹é½ã€å‚ç›´å±…ä¸­
  - æ°´å¹³åˆ†å¸ƒã€å‚ç›´åˆ†å¸ƒ
- **å®ç°**ï¼š`alignNodes` å‡½æ•° + å³é”®èœå•é›†æˆ
- **çŠ¶æ€**ï¼šâœ… æ­£å¸¸å·¥ä½œ

### 3. å…¨é€‰åŠŸèƒ½ (å·²å®Œæˆ)
- **åŠŸèƒ½**ï¼šCtrl+A å¿«æ·é”®å’Œå³é”®èœå•å…¨é€‰
- **å®ç°**ï¼š`selectAllNodes` å‡½æ•° + å¿«æ·é”®ç›‘å¬
- **çŠ¶æ€**ï¼šâœ… æ­£å¸¸å·¥ä½œ

### 4. åŸºç¡€UIç»„ä»¶ (å·²å®Œæˆ)
- **å¯¹é½å‚è€ƒçº¿ç»„ä»¶**ï¼š`AlignmentGuides`
- **å¯¹é½å·¥å…·å‡½æ•°**ï¼š`alignment-utils.ts`
- **çŠ¶æ€**ï¼šâœ… ç»„ä»¶å®Œæˆï¼Œä½†ç®—æ³•éœ€è¦ä¼˜åŒ–

## ğŸš§ ä¸€æœŸé‡åˆ°çš„é—®é¢˜

### 1. æ™ºèƒ½å‚è€ƒçº¿æ£€æµ‹ä¸å‡†ç¡®
- **é—®é¢˜**ï¼šå‚è€ƒçº¿åœ¨ä¸åº”è¯¥æ˜¾ç¤ºæ—¶å‡ºç°ï¼Œè¯¯å¯¼ç”¨æˆ·
- **åŸå› **ï¼šå¯¹é½æ£€æµ‹ç®—æ³•è¿‡äºå®½æ¾ï¼Œé˜ˆå€¼è®¾ç½®ä¸å½“
- **å½“å‰çŠ¶æ€**ï¼šå·²æš‚æ—¶ç¦ç”¨ï¼Œé¿å…ç”¨æˆ·å›°æ‰°

### 2. æ‹–æ‹½äº‹ä»¶å¤„ç†ä¸ç¨³å®š
- **é—®é¢˜**ï¼šæˆªå›¾ç­‰æ“ä½œå¯èƒ½å¯¼è‡´èŠ‚ç‚¹ä½ç½®å¼‚å¸¸
- **åŸå› **ï¼šäº‹ä»¶ç›‘å¬å’ŒçŠ¶æ€ç®¡ç†å­˜åœ¨è¾¹ç•Œæƒ…å†µ
- **å½“å‰çŠ¶æ€**ï¼šå·²éƒ¨åˆ†ä¿®å¤ï¼Œä½†éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–

## ğŸ¯ äºŒæœŸå®ç°è®¡åˆ’

### é˜¶æ®µ1ï¼šæ™ºèƒ½å‚è€ƒçº¿ç®—æ³•é‡æ„ (ä¼˜å…ˆçº§ï¼šé«˜)

#### 1.1 ç²¾ç¡®å¯¹é½æ£€æµ‹
```typescript
// æ–°çš„å¯¹é½æ£€æµ‹ç­–ç•¥
interface AlignmentDetection {
  // ä¸¥æ ¼çš„è·ç¦»é˜ˆå€¼ (2-3px)
  strictThreshold: number;
  
  // åªæ£€æµ‹çœŸæ­£æœ‰æ„ä¹‰çš„å¯¹é½
  alignmentTypes: {
    leftEdge: boolean;    // å·¦è¾¹ç¼˜å¯¹é½
    rightEdge: boolean;   // å³è¾¹ç¼˜å¯¹é½
    centerX: boolean;     // æ°´å¹³ä¸­å¿ƒå¯¹é½
    topEdge: boolean;     // é¡¶éƒ¨è¾¹ç¼˜å¯¹é½
    bottomEdge: boolean;  // åº•éƒ¨è¾¹ç¼˜å¯¹é½
    centerY: boolean;     // å‚ç›´ä¸­å¿ƒå¯¹é½
  };
  
  // æœ€å°èŠ‚ç‚¹æ•°é‡è¦æ±‚
  minNodesForAlignment: number;
}
```

#### 1.2 è§†è§‰ä¼˜åŒ–
- **å‚è€ƒçº¿æ ·å¼**ï¼šæ›´ç»†è…»çš„åŠ¨ç”»æ•ˆæœ
- **é¢œè‰²åŒºåˆ†**ï¼šä¸åŒç±»å‹å¯¹é½ä½¿ç”¨ä¸åŒé¢œè‰²
- **æ ‡ç­¾ä¼˜åŒ–**ï¼šæ˜¾ç¤ºå…·ä½“çš„å¯¹é½ç±»å‹ï¼ˆå¦‚"å·¦è¾¹ç¼˜å¯¹é½"ï¼‰

#### 1.3 æ€§èƒ½ä¼˜åŒ–
- **é˜²æŠ–å¤„ç†**ï¼šé¿å…é¢‘ç¹è®¡ç®—å¯¹é½
- **èŒƒå›´é™åˆ¶**ï¼šåªæ£€æµ‹å¯è§†åŒºåŸŸå†…çš„èŠ‚ç‚¹
- **ç¼“å­˜æœºåˆ¶**ï¼šç¼“å­˜å¯¹é½è®¡ç®—ç»“æœ

### é˜¶æ®µ2ï¼šé«˜çº§å¯¹é½åŠŸèƒ½ (ä¼˜å…ˆçº§ï¼šä¸­)

#### 2.1 æ™ºèƒ½å¸ƒå±€å»ºè®®
```typescript
interface LayoutSuggestion {
  type: 'tree' | 'grid' | 'flow';
  description: string;
  preview: Node[];
  apply: () => void;
}
```

#### 2.2 å¯¹é½å†å²å’Œæ’¤é”€
- **å¯¹é½æ“ä½œå†å²**ï¼šè®°å½•æ¯æ¬¡å¯¹é½æ“ä½œ
- **ä¸€é”®æ’¤é”€**ï¼šæ’¤é”€æœ€è¿‘çš„å¯¹é½æ“ä½œ
- **æ‰¹é‡æ’¤é”€**ï¼šæ’¤é”€ä¸€ç³»åˆ—å¯¹é½æ“ä½œ

#### 2.3 è‡ªå®šä¹‰å¯¹é½è§„åˆ™
```typescript
interface AlignmentRule {
  name: string;
  gridSize: number;
  snapThreshold: number;
  enabledAlignments: AlignmentType[];
  customSpacing: {
    horizontal: number;
    vertical: number;
  };
}
```

### é˜¶æ®µ3ï¼šç”¨æˆ·ä½“éªŒå¢å¼º (ä¼˜å…ˆçº§ï¼šä¸­)

#### 3.1 å¯¹é½é¢„è§ˆ
- **å®æ—¶é¢„è§ˆ**ï¼šæ‹–æ‹½æ—¶æ˜¾ç¤ºå¯¹é½åçš„æ•ˆæœ
- **è™šå½±æ˜¾ç¤º**ï¼šç”¨åŠé€æ˜èŠ‚ç‚¹æ˜¾ç¤ºå¯¹é½ä½ç½®
- **åŠ¨ç”»è¿‡æ¸¡**ï¼šå¹³æ»‘çš„å¯¹é½åŠ¨ç”»

#### 3.2 å¿«æ·é”®å¢å¼º
```typescript
const alignmentShortcuts = {
  'Ctrl+Shift+L': 'alignLeft',      // å·¦å¯¹é½
  'Ctrl+Shift+R': 'alignRight',     // å³å¯¹é½
  'Ctrl+Shift+C': 'alignCenter',    // å±…ä¸­å¯¹é½
  'Ctrl+Shift+T': 'alignTop',       // é¡¶éƒ¨å¯¹é½
  'Ctrl+Shift+B': 'alignBottom',    // åº•éƒ¨å¯¹é½
  'Ctrl+Shift+M': 'alignMiddle',    // å‚ç›´å±…ä¸­
  'Ctrl+Shift+G': 'toggleGrid',     // åˆ‡æ¢ç½‘æ ¼
};
```

#### 3.3 å¯¹é½å·¥å…·æ 
- **ä¸“ç”¨å·¥å…·æ **ï¼šç‹¬ç«‹çš„å¯¹é½å·¥å…·æ 
- **çŠ¶æ€æŒ‡ç¤º**ï¼šæ˜¾ç¤ºå½“å‰å¯¹é½æ¨¡å¼
- **å¿«é€Ÿåˆ‡æ¢**ï¼šä¸€é”®åˆ‡æ¢å¯¹é½é€‰é¡¹

### é˜¶æ®µ4ï¼šé«˜çº§åŠŸèƒ½ (ä¼˜å…ˆçº§ï¼šä½)

#### 4.1 æ™ºèƒ½å¸ƒå±€ç®—æ³•
- **è‡ªåŠ¨å¸ƒå±€**ï¼šåŸºäºè¡Œä¸ºæ ‘ç»“æ„è‡ªåŠ¨æ’åˆ—èŠ‚ç‚¹
- **å±‚æ¬¡å¸ƒå±€**ï¼šæŒ‰ç…§æ ‘çš„å±‚æ¬¡è‡ªåŠ¨å¯¹é½
- **ç´§å‡‘å¸ƒå±€**ï¼šæœ€å°åŒ–èŠ‚ç‚¹é—´è·ç¦»

#### 4.2 å¯¹é½æ¨¡æ¿
```typescript
interface AlignmentTemplate {
  name: string;
  description: string;
  nodePositions: Record<string, Position>;
  apply: (selectedNodes: Node[]) => Node[];
}

const builtinTemplates = [
  'horizontal-flow',    // æ°´å¹³æµç¨‹
  'vertical-tree',      // å‚ç›´æ ‘å½¢
  'grid-layout',        // ç½‘æ ¼å¸ƒå±€
  'radial-layout',      // å¾„å‘å¸ƒå±€
];
```

#### 4.3 åä½œåŠŸèƒ½
- **å¯¹é½åŒæ­¥**ï¼šå¤šäººåä½œæ—¶åŒæ­¥å¯¹é½æ“ä½œ
- **å¯¹é½å†²çªè§£å†³**ï¼šå¤„ç†åŒæ—¶å¯¹é½çš„å†²çª
- **å¯¹é½æƒé™**ï¼šæ§åˆ¶è°å¯ä»¥æ‰§è¡Œå¯¹é½æ“ä½œ

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ ¸å¿ƒç®—æ³•ä¼˜åŒ–
```typescript
// æ–°çš„å¯¹é½æ£€æµ‹ç®—æ³•
function calculatePreciseAlignment(
  draggingNode: Node,
  otherNodes: Node[],
  options: AlignmentOptions
): AlignmentResult {
  // 1. é¢„è¿‡æ»¤ï¼šåªæ£€æµ‹é™„è¿‘çš„èŠ‚ç‚¹
  const nearbyNodes = filterNearbyNodes(draggingNode, otherNodes, 100);
  
  // 2. ç²¾ç¡®è®¡ç®—ï¼šä½¿ç”¨æ›´ä¸¥æ ¼çš„é˜ˆå€¼
  const alignments = calculateExactAlignments(draggingNode, nearbyNodes);
  
  // 3. ä¼˜å…ˆçº§æ’åºï¼šé€‰æ‹©æœ€ä½³å¯¹é½æ–¹æ¡ˆ
  const bestAlignment = selectBestAlignment(alignments);
  
  // 4. éªŒè¯ï¼šç¡®ä¿å¯¹é½ç¡®å®æœ‰æ„ä¹‰
  return validateAlignment(bestAlignment) ? bestAlignment : null;
}
```

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
1. **ç©ºé—´ç´¢å¼•**ï¼šä½¿ç”¨å››å‰æ ‘åŠ é€ŸèŠ‚ç‚¹æŸ¥æ‰¾
2. **å¢é‡è®¡ç®—**ï¼šåªé‡æ–°è®¡ç®—å˜åŒ–çš„éƒ¨åˆ†
3. **Web Worker**ï¼šå¤æ‚è®¡ç®—æ”¾åˆ°åå°çº¿ç¨‹
4. **è™šæ‹ŸåŒ–**ï¼šå¤§é‡èŠ‚ç‚¹æ—¶åªå¤„ç†å¯è§éƒ¨åˆ†

### æµ‹è¯•ç­–ç•¥
```typescript
describe('å¯¹é½åŠŸèƒ½æµ‹è¯•', () => {
  describe('ç²¾ç¡®å¯¹é½æ£€æµ‹', () => {
    test('åº”è¯¥åªåœ¨çœŸæ­£æ¥è¿‘æ—¶æ˜¾ç¤ºå‚è€ƒçº¿');
    test('åº”è¯¥é€‰æ‹©æœ€ä½³çš„å¯¹é½æ–¹æ¡ˆ');
    test('åº”è¯¥å¤„ç†è¾¹ç•Œæƒ…å†µ');
  });
  
  describe('æ‰¹é‡å¯¹é½', () => {
    test('åº”è¯¥æ­£ç¡®å¯¹é½å¤šä¸ªèŠ‚ç‚¹');
    test('åº”è¯¥ä¿æŒç›¸å¯¹ä½ç½®å…³ç³»');
    test('åº”è¯¥å¤„ç†é‡å æƒ…å†µ');
  });
  
  describe('æ€§èƒ½æµ‹è¯•', () => {
    test('å¤§é‡èŠ‚ç‚¹æ—¶åº”è¯¥ä¿æŒæµç•…');
    test('é¢‘ç¹æ‹–æ‹½æ—¶ä¸åº”è¯¥å¡é¡¿');
  });
});
```

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- **å¯¹é½å‡†ç¡®ç‡**ï¼š> 95% çš„å¯¹é½æ“ä½œç¬¦åˆç”¨æˆ·é¢„æœŸ
- **å“åº”æ—¶é—´**ï¼šå¯¹é½æ£€æµ‹å»¶è¿Ÿ < 16ms (60fps)
- **é”™è¯¯ç‡**ï¼šè¯¯æ˜¾ç¤ºå‚è€ƒçº¿çš„æƒ…å†µ < 1%

### åŠŸèƒ½å®Œæ•´æ€§æŒ‡æ ‡
- **å¯¹é½ç±»å‹è¦†ç›–**ï¼šæ”¯æŒæ‰€æœ‰å¸¸ç”¨å¯¹é½æ–¹å¼
- **å¿«æ·é”®è¦†ç›–**ï¼šæ‰€æœ‰å¯¹é½æ“ä½œéƒ½æœ‰å¿«æ·é”®
- **æ’¤é”€æ”¯æŒ**ï¼šæ‰€æœ‰å¯¹é½æ“ä½œéƒ½å¯æ’¤é”€

### æ€§èƒ½æŒ‡æ ‡
- **å¤§è§„æ¨¡æ”¯æŒ**ï¼šæ”¯æŒ 1000+ èŠ‚ç‚¹çš„å¯¹é½æ“ä½œ
- **å†…å­˜ä½¿ç”¨**ï¼šå¯¹é½åŠŸèƒ½å†…å­˜å ç”¨ < 10MB
- **CPUä½¿ç”¨**ï¼šæ‹–æ‹½æ—¶CPUä½¿ç”¨ç‡ < 20%

## ğŸ—“ï¸ å®æ–½æ—¶é—´è¡¨

### ç¬¬ä¸€é˜¶æ®µ (2å‘¨)
- Week 1: é‡æ„å¯¹é½æ£€æµ‹ç®—æ³•
- Week 2: ä¼˜åŒ–å‚è€ƒçº¿æ˜¾ç¤ºå’Œäº¤äº’

### ç¬¬äºŒé˜¶æ®µ (2å‘¨)  
- Week 3: å®ç°é«˜çº§å¯¹é½åŠŸèƒ½
- Week 4: æ·»åŠ å¯¹é½å†å²å’Œæ’¤é”€

### ç¬¬ä¸‰é˜¶æ®µ (1å‘¨)
- Week 5: ç”¨æˆ·ä½“éªŒä¼˜åŒ–å’Œæµ‹è¯•

### ç¬¬å››é˜¶æ®µ (æŒ‰éœ€)
- æ ¹æ®ç”¨æˆ·åé¦ˆå®ç°é«˜çº§åŠŸèƒ½

## ğŸ’¡ è®¾è®¡åŸåˆ™

1. **ç®€å•ä¼˜å…ˆ**ï¼šä¼˜å…ˆå®ç°ç®€å•å¯é çš„åŠŸèƒ½
2. **æ¸è¿›å¢å¼º**ï¼šä»åŸºç¡€åŠŸèƒ½é€æ­¥æ‰©å±•åˆ°é«˜çº§åŠŸèƒ½
3. **ç”¨æˆ·åé¦ˆé©±åŠ¨**ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ä¼˜å…ˆçº§
4. **æ€§èƒ½ç¬¬ä¸€**ï¼šç¡®ä¿åŠŸèƒ½ä¸å½±å“ç¼–è¾‘å™¨æ•´ä½“æ€§èƒ½
5. **ä¸€è‡´æ€§**ï¼šä¸ç¼–è¾‘å™¨æ•´ä½“è®¾è®¡é£æ ¼ä¿æŒä¸€è‡´

## ğŸ” é£é™©è¯„ä¼°

### æŠ€æœ¯é£é™©
- **ç®—æ³•å¤æ‚åº¦**ï¼šå¯¹é½æ£€æµ‹ç®—æ³•å¯èƒ½è¿‡äºå¤æ‚
- **æ€§èƒ½å½±å“**ï¼šå¤§é‡èŠ‚ç‚¹æ—¶å¯èƒ½å½±å“æ€§èƒ½
- **æµè§ˆå™¨å…¼å®¹æ€§**ï¼šæŸäº›æµè§ˆå™¨å¯èƒ½æœ‰æ€§èƒ½å·®å¼‚

### ç”¨æˆ·ä½“éªŒé£é™©
- **å­¦ä¹ æˆæœ¬**ï¼šåŠŸèƒ½è¿‡å¤šå¯èƒ½å¢åŠ å­¦ä¹ æˆæœ¬
- **è¯¯æ“ä½œ**ï¼šè‡ªåŠ¨å¯¹é½å¯èƒ½ä¸ç”¨æˆ·æ„å›¾ä¸ç¬¦
- **è§†è§‰å¹²æ‰°**ï¼šå‚è€ƒçº¿å¯èƒ½å¹²æ‰°æ­£å¸¸ç¼–è¾‘

### ç¼“è§£ç­–ç•¥
- **åˆ†é˜¶æ®µå®æ–½**ï¼šé€æ­¥æ¨å‡ºåŠŸèƒ½ï¼Œæ”¶é›†åé¦ˆ
- **å¯é…ç½®æ€§**ï¼šå…è®¸ç”¨æˆ·è‡ªå®šä¹‰å¯¹é½è¡Œä¸º
- **è¯¦ç»†æ–‡æ¡£**ï¼šæä¾›å®Œæ•´çš„ä½¿ç”¨è¯´æ˜å’Œæœ€ä½³å®è·µ

---

## ğŸ“ å¤‡æ³¨

æ­¤æ–‡æ¡£å°†éšç€å¼€å‘è¿›å±•æŒç»­æ›´æ–°ã€‚æ‰€æœ‰çš„è®¾è®¡å†³ç­–éƒ½åº”è¯¥ä»¥æå‡ç”¨æˆ·ä½“éªŒä¸ºæ ¸å¿ƒç›®æ ‡ã€‚

**æœ€åæ›´æ–°**ï¼š2025-01-13
**è´Ÿè´£äºº**ï¼šCodeBuddy
**çŠ¶æ€**ï¼šäºŒæœŸè§„åˆ’ä¸­
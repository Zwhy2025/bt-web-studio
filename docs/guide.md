### 产品概述

本项目是一个基于 **React + TypeScript + Vite** 技术栈的行为树编辑器和调试工具，旨在为用户提供一个强大的可视化编辑和调试平台。通过该平台，用户可以方便地创建和管理行为树，进行实时调试，并与后端服务进行 WebSocket 通信。该工具主要面向机器人控制、AI 规划、决策树开发等领域，提供灵活的功能支持。

### 核心功能

1. **可视化行为树编辑器**

   * **拖拽式节点创建和连接**：用户可以通过简单的拖拽操作，快速创建行为树节点并将它们连接起来，节点类型包括 Action、Condition、Control、Decorator 等。编辑器提供了丰富的功能，如对节点的多种操作、属性编辑、上下文菜单等。
   * **智能连线规则校验**：该系统通过内建的校验机制，确保节点之间的连接符合逻辑要求（例如，出边只可以连接到入边，禁止自环和回路）。
   * **撤销与重做功能**：支持编辑历史管理，用户可以随时撤销或重做之前的操作，确保编辑过程灵活无忧。
   * **网格背景与缩放**：为了提高用户的编辑效率，提供网格背景以及缩放、平移功能，帮助用户更好地调整视图。
   * **Minimap**：提供行为树的迷你地图，方便用户在复杂的树形结构中快速定位和查看。

2. **实时调试系统**

   * **WebSocket 实时通信协议**：该系统通过 WebSocket 协议与后端服务建立持久连接，实现实时数据交换和状态同步。WebSocket 的使用确保了调试过程中的数据交换高效且稳定。
   * **断点调试功能**：用户可以在特定的节点上设置断点，调试过程中可以暂停执行，查看节点的详细状态，并进行逐步调试。此功能特别适用于复杂行为树的排查和优化。
   * **节点状态实时监控**：系统实时展示每个节点的状态，包括 IDLE（空闲）、RUNNING（执行中）、SUCCESS（成功）、FAILURE（失败），帮助用户快速定位执行中的问题。
   * **黑板管理功能**：黑板作为行为树中用于存储共享数据的中心，调试面板提供了对黑板变量的实时监控和编辑功能，支持数据的动态更新。
   * **事件时间线**：系统会记录行为树执行过程中的每个事件，并通过时间线形式展示，帮助用户追溯执行路径和调试执行过程。

3. **WebSocket通信模块**

   * 实现了与后端服务的实时数据交换和状态同步，支持向后端发送请求、接收数据以及更新行为树的状态。通过 WebSocket，前端可以高效地与后端进行交互，实时反映行为树执行的状态和变化。

4. **XML数据处理**

   * 支持行为树配置的导入、导出以及格式转换。通过 XML 文件，用户可以将行为树的定义、状态信息等进行保存和加载，方便跨平台的数据迁移和版本控制。
   * **XML 文件解析器**：系统提供了专门的 XML 解析器，能够将 XML 格式的数据解析为行为树的节点和连接结构，并支持导出为 XML 格式进行保存。

5. **组件化 UI 系统**

   * 该项目使用 **shadcn/ui** 组件库，确保了现代化、响应式的用户界面。组件库提供了丰富的 UI 元素，保证了不同设备和屏幕尺寸上的良好显示效果，同时支持快速扩展和定制。

### 项目结构

```
bt-web-studio/
├── src/
│   ├── app.tsx                    # 主应用组件 (800行核心代码)
│   ├── layout.tsx                 # 布局组件
│   ├── components/                # 组件目录
│   │   ├── debug-panel.tsx        # 调试面板
│   │   ├── blackboard-panel.tsx   # 黑板管理面板
│   │   ├── tab-bar.tsx           # 多标签管理
│   │   ├── canvas/               # 画布相关组件
│   │   └── ui/                   # shadcn/ui组件
│   ├── lib/                      # 工具库
│   │   ├── unified-behavior-tree-manager.ts  # 统一行为树管理器
│   │   ├── real-websocket-client.ts          # WebSocket客户端
│   │   ├── global-xml-processor.ts           # XML处理器
│   │   └── utils.ts              # 通用工具函数
│   └── store/                    # 状态管理
│       └── behavior-tree-store.ts # Zustand状态存储
├── docs/                         # 文档目录
├── tests/                        # 测试目录
├── tools/                        # 开发工具
└── scripts/                      # 脚本目录
```

### 核心功能模块深度分析

#### 1. **可视化编辑器 (ReactFlow)**

在行为树编辑器的实现中，采用了 **ReactFlow** 库，这是一款用于构建流程图和图形化应用的工具。编辑器提供了强大的图形化操作能力，包括节点的拖拽、删除、调整、对齐等。编辑器还集成了撤销、重做等常用功能，确保用户在构建行为树时操作简单高效。

#### 2. **实时调试系统**

调试面板结合了 **WebSocket** 实时通信协议，能够与后端同步执行状态，实时显示行为树的运行情况。调试面板不仅提供了常见的变量监控，还支持事件时间线的可视化展示，这对于分析和优化复杂的行为树非常有帮助。

#### 3. **XML数据处理引擎**

在 XML 数据处理模块中，系统支持将行为树的状态、节点信息等以 XML 格式导入和导出，方便用户进行跨平台的配置和迁移。同时，系统还提供了灵活的格式转换工具，支持不同格式的数据交互。

#### 4. **状态管理架构 (Zustand)**

状态管理使用 **Zustand**，这是一个简单但功能强大的状态管理库。Zustand 能够高效地管理行为树的状态，包括每个节点的执行状态、断点信息、黑板变量等，确保在调试过程中状态的实时同步。

### 测试策略与工具

该项目为确保高质量运行，采用了严格的测试策略，包括 **WebSocket** 和 **ZMQ** 协议的批量测试。通过模拟后端和真实后端交互，测试了 WebSocket 和 ZMQ 协议的各项功能，确保数据交换和行为树执行的准确性和稳定性。

#### 1. **WebSocket代理批量测试 (proxy\_batch\_test.py)**

该测试脚本重点验证了 WebSocket 连接的稳定性，模拟了与后端的多种交互操作，包括请求树数据、获取状态信息、管理断点等，确保协议的完整性和稳定性。

#### 2. **ZMQ协议批量测试 (zmq\_batch\_test.py)**

该测试脚本针对 ZMQ 协议的请求和响应过程进行了全面覆盖，包括对 12 种不同请求类型的测试，验证了钩子操作、录制操作、断点解锁等功能的正确性。

### 文档体系分析

项目的文档体系分为多个模块，涵盖了从需求分析、协议规范到开发计划的完整信息。每个文档都清晰地定义了项目的技术目标、功能需求、用户角色等信息，确保开发团队对项目的目标和任务有清晰的理解。


# BT Web Studio 编排模式属性面板设计方案

## 1. 设计目标

重新设计编排模式的属性面板，使其更加直观、易用且符合行为树设计的最佳实践。新设计将借鉴Groot编辑器和BehaviorTree.CPP的设计理念，提供强大的端口配置、参数绑定和模型驱动功能。

## 2. 整体布局结构

### 2.1 面板区域划分
1. **顶部节点信息区**：显示节点的基本信息和状态
2. **标签页导航区**：提供不同功能区域的切换
3. **主内容区**：根据选中的标签页显示相应内容
4. **底部操作区**：提供常用操作按钮

### 2.2 标签页设计
1. **基本信息**：节点名称、实例名、类别等基本信息
2. **端口配置**：输入/输出端口的详细配置
3. **参数绑定**：参数与黑板的绑定关系
4. **描述文档**：节点描述和文档信息
5. **高级设置**：模型特定属性和高级配置

## 3. 各区域详细设计

### 3.1 节点基本信息区域
- **模型名**：只读，显示节点的类型名称
- **实例名**：可编辑，节点在行为树中的具体实例名称
- **节点类别**：只读，显示节点的分类
- **Root节点特殊标识**：当节点为Root时显示特殊标识
- **操作按钮**：复制、编辑等常用操作

### 3.2 端口配置区域
- **输入端口列表**：配置所有输入端口
- **输出端口列表**：配置所有输出端口
- **端口配置项**：ID、标签、方向、类型、默认值等
- **端口操作**：添加、删除、编辑、排序
- **Root节点约束**：自动处理Root节点的端口限制

### 3.3 参数和黑板绑定区域
- **参数列表**：展示所有可配置参数
- **绑定配置**：支持字面量输入和黑板绑定切换
- **黑板管理**：显示、搜索、创建黑板键
- **类型安全**：确保参数类型与黑板键类型匹配

### 3.4 描述和文档区域
- **节点描述**：支持Markdown格式的详细描述
- **文档链接**：外部文档链接和内部文档
- **使用示例**：节点使用的示例代码或配置
- **编辑功能**：富文本编辑和实时预览

### 3.5 高级属性区域
- **模型特定属性**：根据节点模型显示特定属性
- **执行控制**：内存模式、成功/失败策略等
- **性能优化**：缓存设置、执行限制等
- **调试辅助**：日志级别、调试标记等

## 4. 特殊规则和约束

### 4.1 Root节点规则
- **唯一性**：整个行为树只能有一个Root节点
- **端口约束**：不允许输入端口，限制输出端口数量
- **连接限制**：不允许任何边连接到Root节点
- **类型固定**：Root节点模型名强制为"Sequence"

### 4.2 模型驱动配置
- **节点模型注册**：定义节点模型的元数据和Schema
- **动态配置界面**：根据模型Schema生成配置界面
- **静态端口保护**：模型定义的端口默认不可删除
- **类型检查**：端口和属性的类型安全验证

## 5. 交互规则和校验逻辑

### 5.1 实时校验
- **输入验证**：实时验证用户输入的合法性
- **约束检查**：检查配置是否满足约束条件
- **错误提示**：提供清晰的错误信息和修复建议

### 5.2 交互设计
- **键盘快捷键**：支持常用操作的快捷键
- **撤销重做**：完整的撤销重做功能
- **批量操作**：支持批量选择和操作多个节点

## 6. 技术实现要点

### 6.1 数据结构设计
- 扩展BehaviorTreeNodeData接口，支持更丰富的属性配置
- 设计端口配置数据结构，支持输入/输出端口的完整信息
- 实现黑板绑定机制，支持参数与黑板键的关联

### 6.2 组件设计
- 设计可复用的端口配置组件
- 实现模型驱动的动态配置组件
- 创建直观的黑板键选择器组件

### 6.3 状态管理
- 集成Zustand状态管理，确保配置的实时同步
- 实现撤销重做机制，支持配置历史管理
- 设计校验逻辑，确保配置的一致性和正确性
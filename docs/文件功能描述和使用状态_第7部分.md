# BT Web Studio 项目文件功能描述和使用状态 - 第7部分

## 目录
- [core/debugger 目录](#coredebugger-目录)
- [core/layout 目录](#corelayout-目录)
- [core/types 目录](#coretypes-目录)
- [core/utils 目录](#coreutils-目录)
- [core/store 目录](#corestore-目录)

## core/debugger 目录

### breakpoint-manager.ts
该文件实现了行为树调试器的断点管理功能。

**功能描述：**
- 支持多种断点类型：总是中断、进入时中断、退出时中断、成功时中断、失败时中断、条件断点
- 提供断点的添加、移除、切换、命中检查等功能
- 支持条件断点的评估，使用Function构造器替代eval以提高安全性
- 实现断点命中事件的管理，包括命中计数、时间戳等
- 提供调试会话状态管理（断开连接、连接中、已连接、运行中、暂停、单步执行、停止）
- 支持断点统计信息获取（总数、启用数、禁用数、命中次数）
- 提供断点配置的导入导出功能

**使用状态：** ACTIVE - 作为调试器的核心组件被调试模式使用

### real-websocket-client.ts
该文件实现了与调试器后端通信的WebSocket客户端。

**功能描述：**
- 实现WebSocket客户端，用于与调试器后端建立和管理实时通信
- 处理消息的发送、接收和连接状态
- 支持发送命令和接收树数据、状态更新、黑板更新等消息
- 提供连接管理功能，包括连接、断开、重连等
- 实现消息处理机制，能够处理不同类型的消息（树数据、节点状态、黑板更新等）
- 支持调试器状态更新通知

**使用状态：** ACTIVE - 作为调试器与后端通信的核心组件

## core/layout 目录

### alignment-utils.ts
该文件提供了节点对齐和吸附功能。

**功能描述：**
- 实现网格吸附功能，将节点位置对齐到网格
- 提供节点对齐参考线计算，包括垂直和水平对齐
- 实现橡皮框选择功能，支持框选范围内的节点选择
- 提供节点批量对齐功能（左对齐、右对齐、居中对齐、顶部对齐、底部对齐、垂直居中对齐）
- 支持节点均匀分布功能（水平分布、垂直分布）
- 实现节点吸附检测，支持节点间的吸附对齐

**使用状态：** ACTIVE - 作为编排模式中的节点对齐和布局工具

### auto-layout-utils.ts
该文件提供了自动布局功能。

**功能描述：**
- 提供自动布局功能，支持树形结构的自动排列
- 实现散乱分布功能，支持节点的随机分布
- 提供布局方向配置（从上到下、从左到右等）
- 支持节点间距设置
- 实现布局算法，能够根据节点连接关系自动排列节点位置

**使用状态：** ACTIVE - 作为编排模式中的自动布局工具

## core/types 目录

### extended-node-types.ts
该文件定义了扩展的节点类型和接口。

**功能描述：**
- 定义扩展的端口配置接口，支持黑板键绑定、默认值、描述等属性
- 定义节点模型定义接口，包含节点的输入输出端口配置
- 提供扩展的行为树节点数据接口，支持节点状态、断点、禁用等属性
- 定义节点类别枚举（动作、条件、控制、装饰器、子树）
- 定义节点状态枚举（空闲、运行中、成功、失败）
- 定义端口方向枚举（输入、输出）

**使用状态：** ACTIVE - 作为项目中节点类型定义的基础

## core/utils 目录

### history-utils.ts
该文件实现了历史管理功能。

**功能描述：**
- 实现撤销(Undo)和重做(Redo)操作
- 提供历史状态的管理和限制功能
- 支持历史记录的添加、清除等操作
- 实现历史记录大小限制，防止内存占用过大

**使用状态：** ACTIVE - 作为编排模式中的历史管理工具

### utils.ts
该文件提供了通用工具函数。

**功能描述：**
- 提供类名合并功能，支持条件性地合并CSS类名
- 实现基本的工具函数，如对象合并、数组操作等

**使用状态：** ACTIVE - 作为项目中的通用工具函数

## core/store 目录

### behavior-tree-store.ts
该文件是整个应用状态管理的核心，整合了所有状态切片。

**功能描述：**
- 使用Zustand创建全局状态存储
- 整合所有模式的状态切片（会话、树、黑板、调试器、时间轴、UI、工作流模式、编排模式、调试模式、回放模式）
- 定义节点状态枚举（空闲、运行中、成功、失败）
- 定义黑板数据类型，支持键值对存储
- 定义扩展的节点和边类型，支持行为树特有属性
- 定义调试状态枚举（断开连接、连接中、已连接、停止、运行、暂停、单步执行）
- 定义执行事件接口，记录节点执行信息
- 定义项目会话接口，支持多会话管理
- 提供各种状态选择器钩子，方便组件访问状态

**使用状态：** ACTIVE - 作为整个应用的状态管理核心

### blackboardState.ts
该文件实现了黑板状态管理。

**功能描述：**
- 实现黑板变量的设置、删除和清除功能
- 提供黑板历史记录功能
- 支持黑板变量的类型管理（字符串、数字、布尔值、对象）
- 实现黑板变量的时间戳记录
- 提供黑板变量的来源追踪（哪个节点设置的）

**使用状态：** ACTIVE - 作为黑板状态管理的核心组件

### composerModeState.ts
该文件实现了编排模式状态管理。

**功能描述：**
- 实现编排模式工具管理（选择、平移、连线、注释）
- 提供节点和边的选择管理
- 实现橡皮框选择功能
- 支持视口管理（缩放、位置、小地图等）
- 提供对齐选项管理（网格吸附、节点吸附等）
- 实现节点库和属性面板配置管理
- 支持编辑历史管理（撤销、重做）
- 提供验证错误管理
- 实现剪贴板功能
- 支持自动布局和虚拟化渲染

**使用状态：** ACTIVE - 作为编排模式的核心状态管理

### debugModeState.ts
该文件实现了调试模式状态管理。

**功能描述：**
- 实现调试会话管理（创建、连接、断开）
- 提供执行控制功能（开始、暂停、停止、单步执行）
- 支持断点管理（添加、移除、切换、清除）
- 实现调用栈管理
- 提供变量监视功能
- 支持日志系统
- 实现可视化设置（执行路径、节点状态、活动节点高亮）

**使用状态：** ACTIVE - 作为调试模式的核心状态管理

### debuggerState.ts
该文件实现了调试器状态管理。

**功能描述：**
- 实现调试器连接管理
- 提供断点管理功能
- 支持执行事件管理
- 实现与调试器后端通信的消息处理
- 提供调试器状态更新通知

**使用状态：** ACTIVE - 作为调试器状态管理的核心组件

### replayModeState.ts
该文件实现了回放模式状态管理。

**功能描述：**
- 实现回放会话管理（加载、创建、保存、删除）
- 提供时间轴控制功能（播放、暂停、停止、跳转、速度调节）
- 支持时间轴标记管理
- 实现事件管理（过滤、搜索、选择）
- 提供可视化设置（事件流、节点轨迹、动画）
- 支持导出功能（JSON、CSV、视频）
- 实现事件预处理和会话验证

**使用状态：** ACTIVE - 作为回放模式的核心状态管理

### sessionState.ts
该文件实现了会话状态管理。

**功能描述：**
- 实现项目会话的创建、切换、更新和删除
- 提供默认会话的创建
- 支持会话数据的管理
- 实现会话的导入导出功能

**使用状态：** ACTIVE - 作为会话管理的核心组件

### timelineState.ts
该文件实现了时间轴状态管理。

**功能描述：**
- 实现执行事件的记录和管理
- 提供时间轴位置控制
- 支持播放速度控制
- 实现事件过滤功能
- 提供时间轴标记管理

**使用状态：** ACTIVE - 作为时间轴状态管理的核心组件

### treeState.ts
该文件实现了行为树状态管理。

**功能描述：**
- 实现节点和边的增删改查功能
- 提供子树展开/折叠功能
- 支持数据导入导出
- 实现节点状态管理
- 提供节点验证功能

**使用状态：** ACTIVE - 作为行为树状态管理的核心组件

### uiState.ts
该文件实现了UI状态管理。

**功能描述：**
- 实现小地图、网格、吸附等功能的开关
- 提供面板大小的管理功能
- 支持UI组件的显示状态管理

**使用状态：** ACTIVE - 作为UI状态管理的核心组件

### workflowModeState.ts
该文件实现了工作模式状态管理。

**功能描述：**
- 实现编排、调试、回放三种模式的切换
- 提供模式切换验证功能
- 支持历史记录管理
- 实现状态保存和恢复功能
- 提供模式过渡动画支持

**使用状态：** ACTIVE - 作为工作模式管理的核心组件